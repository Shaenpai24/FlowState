# System Architecture - Feedback System

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Top Bar     â”‚  â”‚  Auth Dialog â”‚  â”‚  Feedback    â”‚         â”‚
â”‚  â”‚  - Sign In   â”‚  â”‚  - Sign Up   â”‚  â”‚  Dialog      â”‚         â”‚
â”‚  â”‚  - User Menu â”‚  â”‚  - Sign In   â”‚  â”‚  - Submit    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ My Feedback  â”‚  â”‚    Admin     â”‚                           â”‚
â”‚  â”‚ - View Own   â”‚  â”‚  Dashboard   â”‚                           â”‚
â”‚  â”‚ - See Reply  â”‚  â”‚  - Respond   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STATE MANAGEMENT                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Zustand Store (flow-store.ts)               â”‚  â”‚
â”‚  â”‚  - Local state management                                â”‚  â”‚
â”‚  â”‚  - Feedback array with responses                         â”‚  â”‚
â”‚  â”‚  - Sync with Firebase                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Auth Service (auth-service.ts)                 â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Authentication:                                         â”‚  â”‚
â”‚  â”‚  â€¢ signIn(email, password)                              â”‚  â”‚
â”‚  â”‚  â€¢ signUp(email, password)                              â”‚  â”‚
â”‚  â”‚  â€¢ signOut()                                            â”‚  â”‚
â”‚  â”‚  â€¢ onAuthStateChanged()                                 â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  User Management:                                        â”‚  â”‚
â”‚  â”‚  â€¢ getUserRole(uid)                                     â”‚  â”‚
â”‚  â”‚  â€¢ updateUserRole(uid, role)                           â”‚  â”‚
â”‚  â”‚  â€¢ isAdmin(uid)                                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Feedback Management:                                    â”‚  â”‚
â”‚  â”‚  â€¢ submitFeedback(feedback)                             â”‚  â”‚
â”‚  â”‚  â€¢ getFeedback()                                        â”‚  â”‚
â”‚  â”‚  â€¢ getUserFeedback(userId)                              â”‚  â”‚
â”‚  â”‚  â€¢ updateFeedbackStatus(id, status)                    â”‚  â”‚
â”‚  â”‚  â€¢ addFeedbackResponse(id, message)                    â”‚  â”‚
â”‚  â”‚  â€¢ deleteFeedback(id)                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIREBASE BACKEND                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Authentication    â”‚         â”‚    Firestore DB    â”‚         â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚         â”‚
â”‚  â”‚  â€¢ User accounts   â”‚         â”‚  Collections:      â”‚         â”‚
â”‚  â”‚  â€¢ Email/Password  â”‚         â”‚                    â”‚         â”‚
â”‚  â”‚  â€¢ Session mgmt    â”‚         â”‚  ğŸ“ users/         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    {userId}        â”‚         â”‚
â”‚                                 â”‚    - email         â”‚         â”‚
â”‚                                 â”‚    - role          â”‚         â”‚
â”‚                                 â”‚    - createdAt     â”‚         â”‚
â”‚                                 â”‚    - lastLogin     â”‚         â”‚
â”‚                                 â”‚                    â”‚         â”‚
â”‚                                 â”‚  ğŸ“ feedback/      â”‚         â”‚
â”‚                                 â”‚    {feedbackId}    â”‚         â”‚
â”‚                                 â”‚    - type          â”‚         â”‚
â”‚                                 â”‚    - title         â”‚         â”‚
â”‚                                 â”‚    - description   â”‚         â”‚
â”‚                                 â”‚    - rating        â”‚         â”‚
â”‚                                 â”‚    - status        â”‚         â”‚
â”‚                                 â”‚    - userId        â”‚         â”‚
â”‚                                 â”‚    - responses[]   â”‚         â”‚
â”‚                                 â”‚    - resolvedAt    â”‚         â”‚
â”‚                                 â”‚    - resolvedBy    â”‚         â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### User Submits Feedback

```
User fills form
      â”‚
      â–¼
FeedbackDialog
      â”‚
      â”œâ”€â–º authService.submitFeedback()
      â”‚         â”‚
      â”‚         â–¼
      â”‚   Firebase Firestore
      â”‚   (feedback collection)
      â”‚
      â””â”€â–º useFlowStore.createFeedback()
            â”‚
            â–¼
      Local State Updated
```

### Admin Responds to Feedback

```
Admin clicks expand
      â”‚
      â–¼
AdminDashboard
      â”‚
      â”œâ”€â–º Types response
      â”‚
      â–¼
authService.addFeedbackResponse()
      â”‚
      â–¼
Firebase Firestore
(updates feedback doc)
      â”‚
      â–¼
Admin sees confirmation
      â”‚
      â–¼
User sees response in "My Feedback"
```

### User Views Their Feedback

```
User clicks "My Feedback"
      â”‚
      â–¼
MyFeedbackDialog opens
      â”‚
      â–¼
authService.getUserFeedback(userId)
      â”‚
      â–¼
Firebase Firestore query
(filter by userId)
      â”‚
      â–¼
Returns feedback with responses
      â”‚
      â–¼
Display in dialog with admin responses
```

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Firestore Rules                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Request comes in                                           â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Check authentication                                       â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€â–º Anonymous? â”€â”€â–º Can only CREATE feedback          â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€â–º User? â”€â”€â”€â”€â”€â”€â–º Can READ own feedback              â”‚
â”‚       â”‚                 Can CREATE feedback                â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€â–º Admin? â”€â”€â”€â”€â”€â–º Can READ all feedback              â”‚
â”‚                         Can UPDATE feedback                â”‚
â”‚                         Can DELETE feedback                â”‚
â”‚                         Can ADD responses                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Hierarchy

```
App
 â”‚
 â”œâ”€ TopBar
 â”‚   â”œâ”€ AuthDialog (sign in/up)
 â”‚   â”œâ”€ FeedbackDialog (submit)
 â”‚   â”œâ”€ MyFeedbackDialog (view own)
 â”‚   â””â”€ User Menu
 â”‚
 â”œâ”€ Sidebar
 â”‚
 â”œâ”€ Main Content
 â”‚   â”œâ”€ Kanban View
 â”‚   â”œâ”€ List View
 â”‚   â”œâ”€ Calendar View
 â”‚   â””â”€ Admin View
 â”‚       â””â”€ AdminDashboard
 â”‚           â””â”€ Feedback Items
 â”‚               â””â”€ Response Form
 â”‚
 â””â”€ Command Palette
```

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Zustand Store                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  State:                                                  â”‚
â”‚  â€¢ feedback: Feedback[]                                  â”‚
â”‚  â€¢ projects, tasks, notes, etc.                         â”‚
â”‚                                                          â”‚
â”‚  Actions:                                                â”‚
â”‚  â€¢ createFeedback()                                      â”‚
â”‚  â€¢ updateFeedback()                                      â”‚
â”‚  â€¢ deleteFeedback()                                      â”‚
â”‚  â€¢ addFeedbackResponse()                                 â”‚
â”‚  â€¢ loadFeedbackFromFirebase()                           â”‚
â”‚                                                          â”‚
â”‚  Persistence:                                            â”‚
â”‚  â€¢ localStorage (via persist middleware)                â”‚
â”‚  â€¢ Firebase Firestore (via auth-service)                â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Authentication Flow                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sign Up:
  User enters email/password
       â”‚
       â–¼
  authService.signUp()
       â”‚
       â–¼
  Firebase creates user
       â”‚
       â–¼
  Create user doc in Firestore
  (role: 'user')
       â”‚
       â–¼
  User logged in

Sign In:
  User enters email/password
       â”‚
       â–¼
  authService.signIn()
       â”‚
       â–¼
  Firebase validates
       â”‚
       â–¼
  Update lastLogin
       â”‚
       â–¼
  User logged in

Auth State:
  onAuthStateChanged listener
       â”‚
       â–¼
  Updates currentUser in TopBar
       â”‚
       â–¼
  UI updates (show/hide features)
```

## Key Design Decisions

### 1. Dual Storage Strategy
- **Local (Zustand)**: Fast access, offline capability
- **Remote (Firebase)**: Persistence, sync across devices

### 2. Role-Based Access
- **User**: Can view own feedback
- **Admin**: Can manage all feedback
- **Anonymous**: Can submit feedback

### 3. Response Architecture
- Responses stored as array in feedback document
- Each response has ID, message, admin email, timestamp
- Allows multiple responses per feedback

### 4. Status Workflow
```
pending â†’ reviewed â†’ resolved
   â†“         â†“          â†“
 New    Admin saw   Fixed/Done
```

### 5. Security Layers
- Firebase Authentication (who you are)
- Firestore Rules (what you can do)
- Client-side checks (UI optimization)

## Performance Considerations

### Optimizations
- Lazy loading of dialogs
- Pagination ready (not implemented yet)
- Indexed queries in Firestore
- Local state caching

### Potential Bottlenecks
- Loading all feedback at once
- Large response arrays
- No pagination
- Bundle size (1.6MB)

### Future Improvements
- Implement pagination
- Add real-time listeners
- Optimize bundle splitting
- Add service worker for offline
